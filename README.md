# shorturl(短网址服务)
## 用途介绍：
1. 短信或微博等需要贴链接，短链接可帮助符合字数限制，还更直观
2. 需要对某些活动页面的点播数据进行统计
3. 更短的网址生成的二维码更简洁，放于展板上更易识别
## 需求分析：
1. 能根据长网址生成对应短网址
2. 能通过生成的短网址快速跳转到原网址
3. 短网址要防止被恶意遍历访问
4. 服务支持高并发、高可用
5. 若一个长网址曾经被转化过，则返回之前生成的短网址，而部是生成新的短网址
6. 能统计分析各网址的访问频次
7. 能设定短网址的有效期
8. 能人工禁止某短网址的重定向
---
## 方案选型：
1. ### 短网址生成方案：
> 1. 以mysql的自增主键为基础，将其转为64进制字符串--》BASE
> 2. 生成长度为2的随机字符串作为校验值--》checkKey
> 3. 以(BASE+checkKey)的形式作为短网址的内容
> + **用主键做BASE，可以快速生成短网址，反向查询长网址也非常快速**
> + **增加校验值则可以防止被人恶意猜测遍历短网址**

2. ### 重定向方式:
> + 301是永久重定向，浏览器会对跳转的新地址保存一个较长期的缓存
> + 302是临时重定向浏览器不会缓存跳转的新地址，下回还会从老地址访问
> + 选用301的好处是同一浏览器的请求后续请求不会打到短网址服务，可减轻服务压力
> + 选用302的好处是每次请求都会打到短网址服务，方便对访问数据进行分析统计
> + **因为有对访问进行统计分析的需求，固选用302跳转**

3. ### 数据库方案:
> + 因为在本项目的业务场景中，生成新的短网址的操作(数据库写操作)只占很少一部分
> + 而大部分的流量是访问短网址(数据库读操作)
> + 所以可以采用读写分离的模式来降低单库的读压力持续

4. ### 缓存方案:
> 1. 使用Redis做缓存，缓存热点数据(提高响应速度，降低mysql压力)
> 2. Redis采用LRU缓存淘汰策略
> 3. 采用一致性hash算法构建Redis集群
> 4. 由于没有数据更新问题，则无需复杂的缓存一致性策略，单纯添加缓存过期时间即可